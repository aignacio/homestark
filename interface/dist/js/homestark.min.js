var hero=angular.module("superhero",["ui.bootstrap","ngRoute","homeStarkControllers","xeditable","ngAnimate"]);hero.config(["$controllerProvider",function(e){e.allowGlobals()}]),hero.run(["editableOptions",function(e){e.theme="bs3"}]),hero.config(["$routeProvider",function(e){e.when("/dash",{templateUrl:"/pages/windows/dashboard.ejs",controller:""}).when("/devices",{templateUrl:"/pages/windows/devices.ejs",controller:""}).when("/node_map",{templateUrl:"/pages/windows/node_map.ejs",controller:""}).when("/about",{templateUrl:"/pages/windows/about.ejs",controller:""}).otherwise({redirectTo:"/dash",controller:""})}]);
$(document).ready(function(){$(".sidebar-brand").click(function(e){e.preventDefault(),$("#wrapper").toggleClass("toggled"),$("#wrapper").toggleClass("untoggled")})});
var homeStarkController=angular.module("homeStarkControllers",["ui.bootstrap","ngRoute","gridster","ui.knob","uiSwitch","angular-theme-spinner"]);homeStarkController.controller("loginCtrl",["$scope",function(t){t.loadLogin=function(){t["class"]="loading"}}]),homeStarkController.controller("devicesCtrl",["$scope","$http","$timeout",function(t,e,a){t.rowCollection=[],t.displayedCollection=[],t.displayedCollection=[].concat(t.rowCollection),t.$on("$destroy",function(){a.cancel(o)});var o=function(){time=a(o,3e4),e({method:"GET",url:"/devices/list"}).then(function(e){for(var a=0;a<e.data.length;a++)e.data[a].active===!0?e.data[a].active="Ativo":e.data[a].active="Inativo";t.rowCollection=e.data},function(e){t.data=e.data||"Request failed",t.status=e.status,console.log(t.status)})};o()}]),homeStarkController.controller("dashCtrl",["$scope","ShareDash","$uibModal","$timeout","$http",function(t,e,a,o,s){function n(t){for(var e=[],a=0;a<t.length;a++)"switch"==t[a].type&&("0"==t[a].value?t[a].value=!1:t[a].value=!0),e.push({status:t[a].active,sizeX:1,sizeY:1,type:t[a].type,value:t[a].value,name:t[a].name,updated:t[a].updated,hw:t[a].hw_assoc});return e}function l(e){for(var a=0;a<e.length;a++)"switch"==e[a].type&&("0"==e[a].value?e[a].value=!1:e[a].value=!0),t.dash_sensors[a].status=e[a].active,t.dash_sensors[a].value=e[a].value,t.dash_sensors[a].updated=e[a].updated}t.gridsterOpts={columns:4,pushing:!0,floating:!0,swapping:!0,width:"auto",colWidth:300,rowHeight:"match",margins:[10,10],outerMargin:!0,sparse:!1,isMobile:!1,mobileBreakPoint:600,mobileModeEnabled:!0,minColumns:1,minRows:2,maxRows:100,defaultSizeX:2,defaultSizeY:1,minSizeX:1,maxSizeX:null,minSizeY:1,maxSizeY:null,resizable:{enabled:!0,handles:["n","e","s","w","ne","se","sw","nw"],start:function(t,e,a){},resize:function(t,e,a){},stop:function(t,e,a){}},draggable:{enabled:!0}},t.dash_sensors=[],t.options_water={readOnly:!0,unit:"%",subText:{enabled:!0,text:"Nível",color:"gray"},trackWidth:30,barWidth:30,step:1,trackColor:"rgba(52,152,219,.1)",barColor:"rgba(52,152,219,.5)"},t.options_light={readOnly:!0,subText:{enabled:!0,text:"Lux",color:"gray"},bgColor:"#2C3E50",trackWidth:50,barWidth:30,max:2e3,barColor:"#FFAE1A",textColor:"#eee"},t.$on("$destroy",function(){o.cancel(r)}),t.$on("$routeChangeStart",function(t,e,a){o.cancel(r)}),t.toggleSensor=function(e,a,o){var n={hw_assoc:a,type:"toggle"};s({url:"/dash/setData",method:"POST",data:n,headers:{"Content-Type":"application/json"}}).then(function(t){},function(e){t.data=e.data||"Request failed",t.status=e.status,console.log(t.status)})},t.toggleSwitch=function(e,a,o){var n={hw_assoc:a,value:e,type:o};s({url:"/dash/setData",method:"POST",data:n,headers:{"Content-Type":"application/json"}}).then(function(t){},function(e){t.data=e.data||"Request failed",t.status=e.status,console.log(t.status)})};var i=function(){t.showUpdate=!1},r=function(){time=o(r,5e3),t.showUpdate=!0,s({method:"GET",url:"/dash/list"}).then(function(e){o(i,3e3),e.data.length>t.dash_sensors.length?t.dash_sensors=n(e.data):l(e.data)},function(e){t.data=e.data||"Request failed",t.status=e.status,console.log(t.status)})};r(),t.dash=e,t.editDash=function(e,o,s,n,l,i){t.dash.hw=e,t.dash.type=o,t.dash.name=s,t.dash.value=n,t.dash.status=l,t.dash.updated=i;a.open({size:"lg",animation:!0,templateUrl:"modal.html",controller:"modalDashCtrl"})}}]),homeStarkController.controller("modalDashCtrl",["$scope","$timeout","$uibModalInstance","ShareDash","$http","$location",function(t,e,a,o,s,n){t.dash_sensor=o,s({url:"/dash/GetSensor",method:"POST",data:{hw:t.dash_sensor.hw},headers:{"Content-Type":"application/json"}}).then(function(e){e.data.active===!0?e.data.active="Ativo":e.data.active="Inativo",t.sensor=e.data},function(e){t.data=e.data||"Request failed",t.status=e.status,console.log(t.status)}),t.saveCfg=function(){s({url:"/dash/SaveDash",method:"POST",data:{name:t.dash_sensor.name,type:t.dash_sensor.type,hw:t.dash_sensor.hw},headers:{"Content-Type":"application/json"}}).then(function(t){console.log("Alterações salvas!")},function(e){t.data=e.data||"Request failed",t.status=e.status,console.log(t.status)})},t.cancel=function(){a.dismiss()}}]),homeStarkController.service("ShareDash",function(){var t={hw:"",type:"",value:"",name:"",status:"",updated:""};return t}),homeStarkController.controller("networkCtrl",["$scope","$timeout","$http","$location",function(t,e,a,o){function s(t){for(var e=0;e<t.length;e++)"---"!=t[e].ipv6_local&&"---"!=t[e].rota_pref&&(l.push({id:t[e].ipv6_local.split(":")[5],label:t[e].ipv6_local.split(":")[5],group:t[e].type_device}),i.push({from:t[e].ipv6_local.split(":")[5],to:t[e].rota_pref.split(":")[5],label:t[e].rssi_value,font:{strokeWidth:2}}))}var n,l=[{id:"aa04",label:"aa04",group:"border_router"}],i=[],r={interaction:{hover:!0},nodes:{color:"black",shape:"dot",size:30,font:{size:32},borderWidth:0,shadow:!0},edges:{width:2,shadow:!0},groups:{device_switch:{shape:"icon",icon:{face:"FontAwesome",code:"",size:50,color:"black"}},device_water:{shape:"icon",icon:{face:"FontAwesome",code:"",size:50,color:"black"}},device_light:{shape:"icon",icon:{face:"FontAwesome",code:"",size:50,color:"black"}},border_router:{shape:"icon",icon:{face:"FontAwesome",code:"",size:50,color:"black"}}}},d=document.getElementById("networkNodes"),c={nodes:l,edges:i};a({method:"GET",url:"/devices/list"}).then(function(t){s(t.data),n=new vis.Network(d,c,r),n.on("doubleClick",function(t){console.log(t),$(this.document).popover()})},function(e){t.data=e.data||"Request failed",t.status=e.status,console.log(t.status)})}]);